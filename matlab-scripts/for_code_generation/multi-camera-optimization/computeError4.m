function [ f ,J ] = computeError4( x  )
%COMPUTEERROR3 Summary of this function goes here
%   Detailed explanation goes here
    global pts3d;
    global pts2d;
    global inlier;
    global cam;
    global set;
    global nbImages;
    global image_idx;
   
    count = 1;
    f = zeros(sum(sum(inlier)),1);
    J = zeros(sum(sum(inlier)), size(x,2));
    for idx = 1:size(inlier,1)
        for pt_idx = 1:size(inlier,2)
            if inlier(idx,pt_idx) > 0
                p = [(1 + 15* (cam(idx)-1))
                    (2 + 15* (cam(idx)-1))
                    (3 + 15* (cam(idx)-1))
                    (4 + 15* (cam(idx)-1))
                    (5 + 15* (cam(idx)-1))
                    (6 + 15* (cam(idx)-1))
                    (7 + 15* (cam(idx)-1))
                    (8 + 15* (cam(idx)-1))
                    (9 + 15* (cam(idx)-1))
                    (10 + 15* (cam(idx)-1))
                    (11 + 15* (cam(idx)-1))
                    (12 + 15* (cam(idx)-1))
                    (13 + 15* (cam(idx)-1))
                    (14 + 15* (cam(idx)-1))
                    (15 + 15* (cam(idx)-1))
                    
                    (46 + 6* (image_idx(idx)-1))
                    (47 + 6* (image_idx(idx)-1))
                    (48 + 6* (image_idx(idx)-1))
                    (49 + 6* (image_idx(idx)-1))
                    (50 + 6* (image_idx(idx)-1))
                    (51 + 6* (image_idx(idx)-1))];
                
                RxCam = x(1 + 15* (cam(idx)-1));
                RyCam = x(2 + 15* (cam(idx)-1));
                RzCam = x(3 + 15* (cam(idx)-1));
                txCam = x(4 + 15* (cam(idx)-1));
                tyCam = x(5 + 15* (cam(idx)-1));
                tzCam = x(6 + 15* (cam(idx)-1));
                fx = x(7 + 15* (cam(idx)-1));
                fy = x(8 + 15* (cam(idx)-1));
                cx = x(9 + 15* (cam(idx)-1));
                cy = x(10 + 15* (cam(idx)-1));
                k1 = x(11 + 15* (cam(idx)-1));
                k2 = x(12 + 15* (cam(idx)-1));
                p1 = x(13 + 15* (cam(idx)-1));
                p2 = x(14 + 15* (cam(idx)-1));
                k3 = x(15 + 15* (cam(idx)-1));
                               
                X = pts3d(idx,pt_idx,1);
                Y = pts3d(idx,pt_idx,2);
                Z = pts3d(idx,pt_idx,3);
                    
                u = pts2d(idx,pt_idx,1);
                v = pts2d(idx,pt_idx,2);

                RxChess = x(46 + 6* (image_idx(idx)-1));
                RyChess = x(47 + 6* (image_idx(idx)-1));
                RzChess = x(48 + 6* (image_idx(idx)-1));
                txChess = x(49 + 6* (image_idx(idx)-1));
                tyChess = x(50 + 6* (image_idx(idx)-1));
                tzChess = x(51 + 6* (image_idx(idx)-1));
                
                %f((count - 1) * 2 + 1) = u - (cx*(tzCam + (((RxCam^2 + RyCam^2)*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2 + 1)*(tzChess - X*((RyChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RxChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Y*((RxChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RyChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Z*(((RxChess^2 + RyChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)) - ((RyCam*sin((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) + (RxCam*RzCam*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2)*(txChess - Y*((RzChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RxChess*RyChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Z*((RyChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RxChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + X*(((RyChess^2 + RzChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)) + ((RxCam*sin((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - (RyCam*RzCam*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2)*(tyChess + X*((RzChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RxChess*RyChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) - Z*((RxChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RyChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Y*(((RxChess^2 + RzChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1))) + fx*(txCam + (((RyCam^2 + RzCam^2)*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2 + 1)*(txChess - Y*((RzChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RxChess*RyChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Z*((RyChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RxChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + X*(((RyChess^2 + RzChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)) - ((RzCam*sin((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) + (RxCam*RyCam*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2)*(tyChess + X*((RzChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RxChess*RyChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) - Z*((RxChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RyChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Y*(((RxChess^2 + RzChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)) + ((RyCam*sin((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - (RxCam*RzCam*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2)*(tzChess - X*((RyChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RxChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Y*((RxChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RyChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Z*(((RxChess^2 + RyChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1))))/(tzCam + (((RxCam^2 + RyCam^2)*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2 + 1)*(tzChess - X*((RyChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RxChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Y*((RxChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RyChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Z*(((RxChess^2 + RyChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)) - ((RyCam*sin((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) + (RxCam*RzCam*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2)*(txChess - Y*((RzChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RxChess*RyChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Z*((RyChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RxChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + X*(((RyChess^2 + RzChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)) + ((RxCam*sin((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - (RyCam*RzCam*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2)*(tyChess + X*((RzChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RxChess*RyChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) - Z*((RxChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RyChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Y*(((RxChess^2 + RzChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)));
                %f((count - 1) * 2 + 2) = v - (cy*(tzCam + (((RxCam^2 + RyCam^2)*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2 + 1)*(tzChess - X*((RyChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RxChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Y*((RxChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RyChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Z*(((RxChess^2 + RyChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)) - ((RyCam*sin((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) + (RxCam*RzCam*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2)*(txChess - Y*((RzChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RxChess*RyChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Z*((RyChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RxChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + X*(((RyChess^2 + RzChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)) + ((RxCam*sin((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - (RyCam*RzCam*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2)*(tyChess + X*((RzChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RxChess*RyChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) - Z*((RxChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RyChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Y*(((RxChess^2 + RzChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1))) + fy*(tyCam + (((RxCam^2 + RzCam^2)*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2 + 1)*(tyChess + X*((RzChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RxChess*RyChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) - Z*((RxChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RyChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Y*(((RxChess^2 + RzChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)) - ((RxCam*sin((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) + (RyCam*RzCam*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2)*(tzChess - X*((RyChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RxChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Y*((RxChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RyChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Z*(((RxChess^2 + RyChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)) + ((RzCam*sin((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - (RxCam*RyCam*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2)*(txChess - Y*((RzChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RxChess*RyChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Z*((RyChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RxChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + X*(((RyChess^2 + RzChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1))))/(tzCam + (((RxCam^2 + RyCam^2)*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2 + 1)*(tzChess - X*((RyChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RxChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Y*((RxChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RyChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Z*(((RxChess^2 + RyChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)) - ((RyCam*sin((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) + (RxCam*RzCam*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2)*(txChess - Y*((RzChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RxChess*RyChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Z*((RyChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RxChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + X*(((RyChess^2 + RzChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)) + ((RxCam*sin((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - (RyCam*RzCam*(cos((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496) - 1))/((RxCam^2 + RyCam^2 + RzCam^2)^(1/2) + 1/4503599627370496)^2)*(tyChess + X*((RzChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - (RxChess*RyChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) - Z*((RxChess*sin((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) + (RyChess*RzChess*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2) + Y*(((RxChess^2 + RzChess^2)*(cos((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496) - 1))/((RxChess^2 + RyChess^2 + RzChess^2)^(1/2) + 1/4503599627370496)^2 + 1)));
                tmp_proj = projFuncWithDistortion(RxCam,RxChess,RyCam,RyChess,RzCam,RzChess,X,Y,Z,cx,cy,fx,fy,k1,k2,k3,p1,p2,txCam,txChess,tyCam,tyChess,tzCam,tzChess,u,v); 
                tmp_jac = jacFuncWithDistortion(RxCam,RxChess,RyCam,RyChess,RzCam,RzChess,X,Y,Z,cx,cy,fx,fy,k1,k2,k3,p1,p2,txCam,txChess,tyCam,tyChess,tzCam,tzChess,u,v) ;
                %J((count - 1) * 2 + 1, p) =  tmp_jac(1,:);
                %J((count - 1) * 2 + 2, p) =  tmp_jac(2,:);
                f(count) =  tmp_proj;
                J(count, p) =  tmp_jac;
                
                count = count + 1;
            end
        end
    end
   % J(:,31:36) = zeros(sum(sum(inlier)) *2 , 6);
   % [mean(f.*f)  max(f)]
end



